{% comment %}
  Angel Hair Theme - Main Collection Section
{% endcomment %}

<style>
  .collection-main {
    padding: var(--spacing-xl) 0 var(--spacing-xxl);
  }

  .collection-main__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
  }

  .collection-main__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
  }

  .collection-main__count {
    color: var(--color-text-light);
    font-size: 0.875rem;
  }

  .collection-main__sort {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  .collection-main__sort-label {
    font-size: 0.875rem;
    font-weight: 500;
  }

  .collection-main__sort-select {
    padding: 0.5rem 2rem 0.5rem 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-family: inherit;
    font-size: 0.875rem;
    background: white;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232C2C2C' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    cursor: pointer;
  }

  .collection-main__grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    gap: var(--spacing-lg);
  }

  @media (max-width: 1024px) {
    .collection-main__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .collection-main__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }
  }

  @media (max-width: 480px) {
    .collection-main__grid {
      grid-template-columns: 1fr;
    }
  }

  .collection-main__empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: var(--spacing-xxl);
  }

  .collection-main__empty-title {
    margin-bottom: var(--spacing-sm);
  }

  .collection-main__empty-text {
    color: var(--color-text-light);
    margin-bottom: var(--spacing-lg);
  }

  /* Pagination */
  .collection-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing-xs);
    margin-top: var(--spacing-xl);
  }

  .collection-pagination__link {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 44px;
    height: 44px;
    padding: 0 var(--spacing-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    font-weight: 500;
    transition: all var(--transition-fast);
  }

  .collection-pagination__link:hover,
  .collection-pagination__link.is-current {
    background: var(--color-gold);
    border-color: var(--color-gold);
    color: white;
  }

  .collection-pagination__link.is-disabled {
    opacity: 0.4;
    pointer-events: none;
  }

  .collection-pagination__link svg {
    width: 20px;
    height: 20px;
  }
</style>

<section class="collection-main" data-section-id="{{ section.id }}">
  <div class="collection-main__container">
    <header class="collection-main__header">
      <span class="collection-main__count">
        {{ collection.products_count }} 
        {%- if collection.products_count == 1 -%}product{%- else -%}products{%- endif -%}
      </span>

      {%- if section.settings.enable_sorting -%}
        <div class="collection-main__sort">
          <label for="SortBy" class="collection-main__sort-label">Sort by:</label>
          <select id="SortBy" class="collection-main__sort-select" data-sort-by>
            {%- for option in collection.sort_options -%}
              <option value="{{ option.value }}" {% if option.value == collection.sort_by %}selected{% endif %}>
                {{ option.name }}
              </option>
            {%- endfor -%}
          </select>
        </div>
      {%- endif -%}
    </header>

    {%- if collection.products.size > 0 -%}
      <div class="collection-main__grid">
        {%- paginate collection.products by section.settings.products_per_page -%}
          {%- for product in collection.products -%}
            <div class="product-card" data-animate="fade-up" style="animation-delay: {{ forloop.index | times: 50 }}ms;">
              <div class="product-card__media">
                <a href="{{ product.url }}">
                  {%- if product.featured_media -%}
                    <img 
                      src="{{ product.featured_media | image_url: width: 600 }}"
                      srcset="{{ product.featured_media | image_url: width: 300 }} 300w,
                              {{ product.featured_media | image_url: width: 600 }} 600w"
                      sizes="(max-width: 640px) 50vw, 25vw"
                      alt="{{ product.featured_media.alt | default: product.title | escape }}"
                      class="product-card__image"
                      loading="lazy"
                    >
                    {%- if product.media[1] and section.settings.show_secondary_image -%}
                      <img 
                        src="{{ product.media[1] | image_url: width: 600 }}"
                        alt="{{ product.media[1].alt | default: product.title | escape }}"
                        class="product-card__image product-card__image--secondary"
                        loading="lazy"
                      >
                    {%- endif -%}
                  {%- else -%}
                    {{ 'product-1' | placeholder_svg_tag: 'product-card__image placeholder' }}
                  {%- endif -%}
                </a>

                <div class="product-card__badges">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="badge badge--sale">Sale</span>
                  {%- endif -%}
                  {%- if product.available == false -%}
                    <span class="badge badge--soldout">Sold Out</span>
                  {%- endif -%}
                </div>

                {%- if section.settings.enable_quick_add and product.available -%}
                  {%- if product.variants.size == 1 -%}
                    <product-form>
                      <form action="/cart/add" method="post">
                        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="button button--primary button--quick-view">
                          Quick Add
                        </button>
                      </form>
                    </product-form>
                  {%- else -%}
                    <a href="{{ product.url }}" class="button button--secondary button--quick-view">
                      Select Options
                    </a>
                  {%- endif -%}
                {%- endif -%}
              </div>

              <div class="product-card__content">
                {%- if section.settings.show_vendor -%}
                  <span class="product-card__vendor">{{ product.vendor }}</span>
                {%- endif -%}

                <h3 class="product-card__title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h3>

                {%- if section.settings.show_rating -%}
                  <div class="product-card__rating">
                    {% render 'star-rating', rating: 5 %}
                  </div>
                {%- endif -%}

                <div class="product-card__price price">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="price__sale">{{ product.price | money }}</span>
                    <span class="price__compare">{{ product.compare_at_price | money }}</span>
                  {%- else -%}
                    <span class="price__regular">{{ product.price | money }}</span>
                  {%- endif -%}
                </div>
              </div>
            </div>
          {%- endfor -%}

          {%- if paginate.pages > 1 -%}
            <nav class="collection-pagination" style="grid-column: 1 / -1;">
              {%- if paginate.previous -%}
                <a href="{{ paginate.previous.url }}" class="collection-pagination__link" aria-label="Previous page">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                  </svg>
                </a>
              {%- else -%}
                <span class="collection-pagination__link is-disabled">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                  </svg>
                </span>
              {%- endif -%}

              {%- for part in paginate.parts -%}
                {%- if part.is_link -%}
                  <a href="{{ part.url }}" class="collection-pagination__link">{{ part.title }}</a>
                {%- else -%}
                  {%- if part.title == paginate.current_page -%}
                    <span class="collection-pagination__link is-current">{{ part.title }}</span>
                  {%- else -%}
                    <span class="collection-pagination__link">{{ part.title }}</span>
                  {%- endif -%}
                {%- endif -%}
              {%- endfor -%}

              {%- if paginate.next -%}
                <a href="{{ paginate.next.url }}" class="collection-pagination__link" aria-label="Next page">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </a>
              {%- else -%}
                <span class="collection-pagination__link is-disabled">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </span>
              {%- endif -%}
            </nav>
          {%- endif -%}
        {%- endpaginate -%}
      </div>
    {%- else -%}
      <div class="collection-main__empty">
        <h2 class="collection-main__empty-title">No products found</h2>
        <p class="collection-main__empty-text">This collection doesn't have any products yet.</p>
        <a href="/collections/all" class="button button--primary">Browse All Products</a>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  // Sort functionality
  document.querySelector('[data-sort-by]')?.addEventListener('change', function() {
    const url = new URL(window.location.href);
    url.searchParams.set('sort_by', this.value);
    window.location.href = url.toString();
  });
</script>

{% schema %}
{
  "name": "Product Grid",
  "tag": "section",
  "class": "section-collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12,
      "label": "Products Per Page"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Columns (Desktop)"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image Ratio",
      "options": [
        { "value": "adapt", "label": "Adapt to Image" },
        { "value": "square", "label": "Square" },
        { "value": "portrait", "label": "Portrait" }
      ],
      "default": "square"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "label": "Show Secondary Image on Hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show Rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "Enable Quick Add",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable Filtering",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable Sorting",
      "default": true
    }
  ]
}
{% endschema %}

