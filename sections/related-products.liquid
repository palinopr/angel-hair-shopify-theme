{% comment %}
  Angel Hair Theme - Related Products Section
{% endcomment %}

<style>
  .related-products {
    padding: var(--spacing-xxl) 0;
    background: var(--color-cream);
  }

  .related-products__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
  }

  .related-products__header {
    text-align: center;
    margin-bottom: var(--spacing-xl);
  }

  .related-products__title {
    margin-bottom: var(--spacing-sm);
  }

  .related-products__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
  }

  @media (max-width: 1024px) {
    .related-products__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .related-products__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }
  }

  .related-products .product-card {
    background: white;
  }
</style>

{%- if recommendations.performed and recommendations.products_count > 0 -%}
  <section class="related-products" data-section-id="{{ section.id }}">
    <div class="related-products__container">
      <header class="related-products__header">
        <h2 class="related-products__title">{{ section.settings.title }}</h2>
        <div class="divider"></div>
      </header>

      <div class="related-products__grid">
        {%- for product in recommendations.products limit: section.settings.products_to_show -%}
          <div class="product-card" data-animate="fade-up" style="animation-delay: {{ forloop.index | times: 100 }}ms;">
            <div class="product-card__media">
              <a href="{{ product.url }}">
                {%- if product.featured_media -%}
                  <img 
                    src="{{ product.featured_media | image_url: width: 600 }}"
                    alt="{{ product.featured_media.alt | default: product.title | escape }}"
                    class="product-card__image"
                    loading="lazy"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'product-card__image placeholder' }}
                {%- endif -%}
              </a>

              <div class="product-card__badges">
                {%- if product.compare_at_price > product.price -%}
                  <span class="badge badge--sale">Sale</span>
                {%- endif -%}
              </div>
            </div>

            <div class="product-card__content">
              <h3 class="product-card__title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              <div class="product-card__rating">
                {% render 'star-rating', rating: 5 %}
              </div>

              <div class="product-card__price price">
                {%- if product.compare_at_price > product.price -%}
                  <span class="price__sale">{{ product.price | money }}</span>
                  <span class="price__compare">{{ product.compare_at_price | money }}</span>
                {%- else -%}
                  <span class="price__regular">{{ product.price | money }}</span>
                {%- endif -%}
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </section>
{%- endif -%}

{% schema %}
{
  "name": "Related Products",
  "tag": "section",
  "class": "section-related-products",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "You May Also Like"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 4,
      "label": "Products to Show"
    }
  ]
}
{% endschema %}

