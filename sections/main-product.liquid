{% comment %}
  Angel Hair Theme - Main Product Section
{% endcomment %}

<style>
  .product-main {
    padding: var(--spacing-xl) 0 var(--spacing-xxl);
  }

  .product-main__container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
  }

  .product-main__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-xxl);
    align-items: start;
  }

  @media (max-width: 1024px) {
    .product-main__grid {
      grid-template-columns: 1fr;
      gap: var(--spacing-xl);
    }
  }

  /* Media Gallery */
  .product-gallery {
    position: sticky;
    top: calc(var(--header-height) + var(--spacing-lg));
  }

  @media (max-width: 1024px) {
    .product-gallery {
      position: static;
    }
  }

  .product-gallery__main {
    position: relative;
    margin-bottom: var(--spacing-md);
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: var(--color-cream);
  }

  .product-gallery__image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
  }

  .product-gallery__thumbnails {
    display: flex;
    gap: var(--spacing-sm);
    overflow-x: auto;
    padding-bottom: var(--spacing-xs);
  }

  .product-gallery__thumbnail {
    flex: 0 0 80px;
    width: 80px;
    height: 80px;
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color var(--transition-fast);
  }

  .product-gallery__thumbnail.is-active,
  .product-gallery__thumbnail:hover {
    border-color: var(--color-gold);
  }

  .product-gallery__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Product Info */
  .product-info {
    padding: var(--spacing-md) 0;
  }

  .product-info__vendor {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-gold);
    margin-bottom: var(--spacing-sm);
  }

  .product-info__title {
    font-size: 2rem;
    margin-bottom: var(--spacing-sm);
  }

  .product-info__rating {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
  }

  .product-info__price {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
  }

  .product-info__price-current {
    font-family: var(--font-heading-family);
    font-size: 2rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .product-info__price-compare {
    font-size: 1.25rem;
    color: var(--color-text-light);
    text-decoration: line-through;
  }

  .product-info__price-badge {
    padding: 0.25rem 0.75rem;
    background: var(--color-error);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: var(--radius-full);
  }

  .product-info__description {
    color: var(--color-text-light);
    line-height: 1.8;
    margin-bottom: var(--spacing-lg);
  }

  /* Variants */
  .product-variants {
    margin-bottom: var(--spacing-lg);
  }

  .product-variant {
    margin-bottom: var(--spacing-md);
  }

  .product-variant__label {
    display: block;
    font-weight: 600;
    margin-bottom: var(--spacing-sm);
  }

  .product-variant__options {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
  }

  .product-variant__option {
    padding: 0.75rem 1.25rem;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-md);
    background: white;
    cursor: pointer;
    transition: all var(--transition-fast);
    font-family: inherit;
    font-size: 0.875rem;
  }

  .product-variant__option:hover,
  .product-variant__option.is-selected {
    border-color: var(--color-gold);
    background: var(--color-gold-light);
  }

  .product-variant__option.is-unavailable {
    opacity: 0.4;
    text-decoration: line-through;
    cursor: not-allowed;
  }

  /* Quantity & Add to Cart */
  .product-actions {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
  }

  @media (max-width: 640px) {
    .product-actions {
      flex-direction: column;
    }
  }

  .product-actions__quantity {
    flex-shrink: 0;
  }

  .product-actions__add {
    flex: 1;
  }

  .product-actions__add .button {
    width: 100%;
    min-height: 54px;
  }

  /* Buy Now */
  .product-buy-now {
    margin-bottom: var(--spacing-lg);
  }

  /* Trust Badges */
  .product-trust {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--color-cream);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-lg);
  }

  .product-trust__item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.875rem;
    color: var(--color-text-light);
  }

  .product-trust__item svg {
    width: 20px;
    height: 20px;
    color: var(--color-gold);
  }

  /* Share */
  .product-share {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
  }

  .product-share__label {
    font-weight: 600;
    font-size: 0.875rem;
  }

  .product-share__buttons {
    display: flex;
    gap: var(--spacing-xs);
  }
</style>

<section class="product-main" data-section-id="{{ section.id }}">
  <div class="product-main__container">
    <div class="product-main__grid">
      <!-- Media Gallery -->
      <div class="product-gallery">
        <div class="product-gallery__main">
          {%- if product.featured_media -%}
            <img 
              id="ProductMainImage"
              src="{{ product.featured_media | image_url: width: 800 }}"
              alt="{{ product.featured_media.alt | default: product.title | escape }}"
              class="product-gallery__image"
              loading="eager"
            >
          {%- else -%}
            {{ 'product-1' | placeholder_svg_tag: 'product-gallery__image placeholder' }}
          {%- endif -%}
        </div>

        {%- if product.media.size > 1 -%}
          <div class="product-gallery__thumbnails">
            {%- for media in product.media -%}
              <button 
                class="product-gallery__thumbnail {% if forloop.first %}is-active{% endif %}"
                data-thumbnail
                data-image="{{ media | image_url: width: 800 }}"
                aria-label="View image {{ forloop.index }}"
              >
                <img 
                  src="{{ media | image_url: width: 160 }}"
                  alt="{{ media.alt | default: product.title | escape }}"
                  loading="lazy"
                >
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      <!-- Product Info -->
      <div class="product-info">
        {%- if product.vendor != blank -%}
          <span class="product-info__vendor">{{ product.vendor }}</span>
        {%- endif -%}

        <h1 class="product-info__title">{{ product.title }}</h1>

        <div class="product-info__rating">
          {% render 'star-rating', rating: 5, count: 12 %}
        </div>

        <div class="product-info__price">
          {%- if product.compare_at_price > product.price -%}
            <span class="product-info__price-current">{{ product.price | money }}</span>
            <span class="product-info__price-compare">{{ product.compare_at_price | money }}</span>
            {%- assign savings = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
            <span class="product-info__price-badge">Save {{ savings }}%</span>
          {%- else -%}
            <span class="product-info__price-current">{{ product.price | money }}</span>
          {%- endif -%}
        </div>

        {%- if product.description != blank -%}
          <div class="product-info__description rte">
            {{ product.description }}
          </div>
        {%- endif -%}

        <product-form>
          {%- form 'product', product, id: 'ProductForm', data-type: 'add-to-cart-form' -%}
            <!-- Variants -->
            {%- unless product.has_only_default_variant -%}
              <div class="product-variants">
                {%- for option in product.options_with_values -%}
                  <div class="product-variant">
                    <label class="product-variant__label">{{ option.name }}</label>
                    <div class="product-variant__options">
                      {%- for value in option.values -%}
                        <button 
                          type="button" 
                          class="product-variant__option {% if option.selected_value == value %}is-selected{% endif %}"
                          data-option="{{ option.name }}"
                          data-value="{{ value }}"
                        >
                          {{ value }}
                        </button>
                      {%- endfor -%}
                    </div>
                  </div>
                {%- endfor -%}
              </div>
            {%- endunless -%}

            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

            <!-- Quantity & Add to Cart -->
            <div class="product-actions">
              <div class="product-actions__quantity">
                <quantity-input class="quantity-selector">
                  <button type="button" name="minus" aria-label="Decrease quantity">âˆ’</button>
                  <input type="number" name="quantity" value="1" min="1" aria-label="Quantity">
                  <button type="button" name="plus" aria-label="Increase quantity">+</button>
                </quantity-input>
              </div>
              
              <div class="product-actions__add">
                {%- if product.available -%}
                  <button type="submit" class="button button--primary button--large button--add-to-cart">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
                      <path d="M3 6h18"></path>
                      <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                    Add to Cart
                  </button>
                {%- else -%}
                  <button type="button" class="button button--sold-out button--large" disabled>
                    Sold Out
                  </button>
                {%- endif -%}
              </div>
            </div>

            {%- if section.settings.show_dynamic_checkout -%}
              <div class="product-buy-now">
                {{ form | payment_button }}
              </div>
            {%- endif -%}
          {%- endform -%}
        </product-form>

        <!-- Trust Badges -->
        <div class="product-trust">
          <div class="product-trust__item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="3" width="15" height="13"></rect>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
              <circle cx="5.5" cy="18.5" r="2.5"></circle>
              <circle cx="18.5" cy="18.5" r="2.5"></circle>
            </svg>
            Free Shipping
          </div>
          <div class="product-trust__item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Secure Payment
          </div>
          <div class="product-trust__item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
            30-Day Returns
          </div>
        </div>

        <!-- Share -->
        <div class="product-share">
          <span class="product-share__label">Share:</span>
          <div class="product-share__buttons">
            <a href="https://www.facebook.com/sharer.php?u={{ shop.url }}{{ product.url }}" target="_blank" class="button--social" aria-label="Share on Facebook">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
              </svg>
            </a>
            <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ product.url }}&text={{ product.title | url_encode }}" target="_blank" class="button--social" aria-label="Share on Twitter">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
              </svg>
            </a>
            <a href="https://wa.me/?text={{ product.title | url_encode }}%20{{ shop.url }}{{ product.url }}" target="_blank" class="button--social" aria-label="Share on WhatsApp">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Product JSON for Meta Pixel -->
<script type="application/json" data-product-json>
  {{ product | json }}
</script>

<script>
  // Thumbnail gallery functionality
  document.querySelectorAll('[data-thumbnail]').forEach(thumb => {
    thumb.addEventListener('click', function() {
      const mainImage = document.getElementById('ProductMainImage');
      const newSrc = this.dataset.image;
      
      if (mainImage && newSrc) {
        mainImage.src = newSrc;
        document.querySelectorAll('[data-thumbnail]').forEach(t => t.classList.remove('is-active'));
        this.classList.add('is-active');
      }
    });
  });
</script>

{% schema %}
{
  "name": "Product Information",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "label": "Enable Sticky Product Info",
      "default": true
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery Layout",
      "options": [
        { "value": "thumbnail_slider", "label": "Thumbnails Below" },
        { "value": "stacked", "label": "Stacked" }
      ],
      "default": "thumbnail_slider"
    },
    {
      "type": "select",
      "id": "media_size",
      "label": "Media Size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "large"
    },
    {
      "type": "checkbox",
      "id": "show_dynamic_checkout",
      "label": "Show Dynamic Checkout Button",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "select",
          "id": "text_style",
          "label": "Text Style",
          "options": [
            { "value": "body", "label": "Body" },
            { "value": "uppercase", "label": "Uppercase" }
          ],
          "default": "body"
        }
      ]
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "rating",
      "name": "Rating",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "label": "Type",
          "options": [
            { "value": "dropdown", "label": "Dropdown" },
            { "value": "button", "label": "Buttons" }
          ],
          "default": "button"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show Dynamic Checkout",
          "default": true
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "Label",
          "default": "Share"
        }
      ]
    }
  ]
}
{% endschema %}

